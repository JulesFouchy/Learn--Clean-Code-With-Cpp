<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">CMake | Clean Code with C++</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://julesfouchy.github.io//Learn--Clean-Code-With-Cpp/lessons/cmake/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CMake | Clean Code with C++"><meta data-react-helmet="true" name="description" content="Brief"><meta data-react-helmet="true" property="og:description" content="Brief"><link data-react-helmet="true" rel="icon" href="/Learn--Clean-Code-With-Cpp/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://julesfouchy.github.io//Learn--Clean-Code-With-Cpp/lessons/cmake/"><link data-react-helmet="true" rel="alternate" href="https://julesfouchy.github.io//Learn--Clean-Code-With-Cpp/lessons/cmake/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://julesfouchy.github.io//Learn--Clean-Code-With-Cpp/lessons/cmake/" hreflang="x-default"><link rel="stylesheet" href="/Learn--Clean-Code-With-Cpp/assets/css/styles.e1c8cc4f.css">
<link rel="preload" href="/Learn--Clean-Code-With-Cpp/assets/js/runtime~main.9ea0f819.js" as="script">
<link rel="preload" href="/Learn--Clean-Code-With-Cpp/assets/js/main.83d7c98f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Learn--Clean-Code-With-Cpp/"><div class="navbar__logo"><img src="/Learn--Clean-Code-With-Cpp/img/favicon-32x32.png" alt="Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/Learn--Clean-Code-With-Cpp/img/favicon-32x32.png" alt="Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Learn--Clean-Code-With-Cpp/lessons/">Lessons</a><a class="navbar__item navbar__link" href="/Learn--Clean-Code-With-Cpp/resources/">Resources</a><a class="navbar__item navbar__link" href="/Learn--Clean-Code-With-Cpp/tools/">Tools</a><a class="navbar__item navbar__link" href="/Learn--Clean-Code-With-Cpp/sujet/">Sujet</a><a class="navbar__item navbar__link" href="/Learn--Clean-Code-With-Cpp/evaluation/">Evaluation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/JulesFouchy/Learn--Clean-Code-With-Cpp/issues/new/choose" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-issues-link" aria-label="GitHub issues" title="Ask a question"></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Learn--Clean-Code-With-Cpp/lessons/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Learn--Clean-Code-With-Cpp/lessons/install-a-compiler/">The Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Learn--Clean-Code-With-Cpp/lessons/classes-and-structs/">C++ Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Learn--Clean-Code-With-Cpp/lessons/make-it-work-then-make-it-good/">Clean Code</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Learn--Clean-Code-With-Cpp/lessons/use-libraries/">Good practices and patterns</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/Learn--Clean-Code-With-Cpp/lessons/static-site-generators/">Good to know</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Learn--Clean-Code-With-Cpp/lessons/static-site-generators/">Static site generators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Learn--Clean-Code-With-Cpp/lessons/cmake/">CMake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Learn--Clean-Code-With-Cpp/lessons/precompiled-header/">Precompiled Header</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Learn--Clean-Code-With-Cpp/lessons/write-libraries/">Advanced</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Learn--Clean-Code-With-Cpp/lessons/avoid-nested-namespaces/">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CMake</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="brief">Brief<a class="hash-link" href="#brief" title="Direct link to heading">â€‹</a></h2><p>To understand modern CMake you need to understand <em>targets</em>. Basically a target is an executable or a library. You will define a target for your executable and describe its source files, and then you will import the targets for each library you use, and will add those targets as a dependency of your executable. Here is an example:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project(p6-hello-world)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(${PROJECT_NAME} # Creates a target called ${PROJECT_NAME}, a.k.a. p6-hello-world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    src/main.cpp               # And adds its source files: main.cpp and something.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    src/something.cpp          # Note that you don&#x27;t need to list the header files here (.h / .hpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_include_directories(${PROJECT_NAME} PRIVATE src) # Directory containing our header files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_subdirectory(p6)                                  # Includes the p6 library; this assumes that you have a folder called p6 at the same level as this CMakeLists.txt file, and that the p6 folder contains a CMakeLists.txt file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(${PROJECT_NAME} PRIVATE p6::p6) # Adds the target &quot;p6::p6&quot; as a dependency of our target ${PROJECT_NAME}. Unfortunately the command is called target_link_libraries() even though it can be used for other things than just linking; don&#x27;t get confused! A better name would have been add_dependency()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      # The name of the target &quot;p6::p6&quot; is up to the library authors. Check out their documentation to know how they called it!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      # The &quot;::&quot; in the name of the library&#x27;s target is not mandatory, but library authors often add it because target_link_libraries() can do many different things, and if you make a typo in the name of the target it will ignore it instead of reporting an error. It is only if you have a &quot;::&quot; in the name that target_link_libraries() will know that it can&#x27;t be anything but a target and will raise an error if the name doesn&#x27;t actually correspond to a target.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And that is all you need for a basic <em>CMakeLists.txt</em>!</p><p>If all your libraries define a target properly then you don&#x27;t need anything more to build your project. (If they don&#x27;t, unfortunately you will have to <a href="#cmake-for-library-authors">do their job for them</a>).</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="cmake-tips">CMake tips<a class="hash-link" href="#cmake-tips" title="Direct link to heading">â€‹</a></h2><p>Now we will see a few useful things that you can do with CMake:</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="setting-your-c-version">Setting your C++ version<a class="hash-link" href="#setting-your-c-version" title="Direct link to heading">â€‹</a></h3><p>You can ask for a specific version of C++:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_compile_features(${PROJECT_NAME} PRIVATE cxx_std_20)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>(If you don&#x27;t you will probably get C++11 by default).</p><p>You can even ask for finer details with parameters like <code>cxx_variadic_templates</code>. This can be useful to increase the portability of your code a little bit (for example if you need C++11 plus only one little feature from C++14). Don&#x27;t abuse it though because it can be very tedious to maintain!</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="glob">GLOB<a class="hash-link" href="#glob" title="Direct link to heading">â€‹</a></h3><p>If you don&#x27;t want to have to list all your <em>.cpp</em> files manually in your <em>CMakeLists.txt</em> you can use </p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">file(GLOB_RECURSE MY_SOURCES CONFIGURE_DEPENDS src/*)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It will grab the list of all <em>.cpp</em> files in <em>src</em> ant put then in <code>MY_SOURCES</code>.</p><ul><li><p><code>GLOB_RECURSE</code> means that it will also find the files that are in the subdirectories of <em>src</em>. If you only want to find the files at the first level of <em>src</em> you can use <code>GLOB</code> instead.</p></li><li><p><code>CONFIGURE_DEPENDS</code> means that CMake will check before every build to see if files were added or deleted, and if so it will update accordingly. Without it you would need to manually tell CMake to reconfigure each time you add or remove a file.</p></li></ul><p>You can then use that list of files like so:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(${PROJECT_NAME} ${MY_SOURCES})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>Every CMake expert will tell you that you should never use <code>file(GLOB)</code> or <code>file(GLOB_RECURSE)</code>. The reason is always the same and can be found in the <a href="https://cmake.org/cmake/help/latest/command/file.html#filesystem" target="_blank" rel="noopener noreferrer">official CMake documentation</a>:</p><blockquote><p>We do not recommend using GLOB to collect a list of source files from your source tree. If no CMakeLists.txt file changes when a source is added or removed then the generated build system cannot know when to ask CMake to regenerate. The <code>CONFIGURE_DEPENDS</code> flag may not work reliably on all generators, or if a new generator is added in the future that cannot support it, projects using it will be stuck. Even if <code>CONFIGURE_DEPENDS</code> works reliably, there is still a cost to perform the check on every rebuild.</p></blockquote><p>I disagree with it though, since to me maintaining a list of my <em>.cpp</em> files in my <em>CMakeLists.txt</em> is more of a hassle than having to refresh CMake manually when I add or remove a file. (And <code>CONFIGURE_DEPENDS</code> makes it even less of a hassle).</p><p>Now that you have the arguments from both sides, pick your poison. </p></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If it is hard to add new files to your codebase people will tend to try and avoid it, and will put more things in one single file, which might not be desirable. If you want to encourage people to write many small files, using <code>GLOB_RECURSE</code> might be a good idea ðŸ˜‰</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="adding-libraries">Adding libraries<a class="hash-link" href="#adding-libraries" title="Direct link to heading">â€‹</a></h3><p>In order to make sure that anybody cloning your repository will have all the required libraries to compile your project, it is important to have a way to automatically download them. <a href="/Learn--Clean-Code-With-Cpp/lessons/git-submodules">Submodules</a> are one way of achieving this, but in the case of external libraries that you are not actively writing yourself (which should be most of the cases, especially if you are a beginner programmer), then submodules are a bit annoying and don&#x27;t bring any value. In that case, CMake offers a better alternative: <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html" target="_blank" rel="noopener noreferrer">FetchContent</a>. It will automatically download the libraries when necessary:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">FetchContent_Declare( # Declare a library: its name and where to find it </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p6                                               # Name of the library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GIT_REPOSITORY https://github.com/julesfouchy/p6 # Repo of the library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GIT_TAG 8346d1e27567815bb9b231cf3ecbfaf1e3bd832a # Exact commit hash that you want to use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FetchContent_MakeAvailable(p6) # Download the library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(${PROJECT_NAME} PRIVATE p6::p6) # Link the library as usual</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can find the hash of a commit on GitHub / GitLab: (by default choosing the latest commit should be fine):</p><p><img src="/Learn--Clean-Code-With-Cpp/assets/images/commit-hash-506269a51e35603bd6f3103e7762b9ce.png" width="1920" height="616"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="enabling-warnings">Enabling warnings<a class="hash-link" href="#enabling-warnings" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">if (MSVC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_compile_options(${PROJECT_NAME} PRIVATE /WX /W4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_compile_options(${PROJECT_NAME} PRIVATE -Werror -Wall -Wextra -Wpedantic -pedantic-errors -Wimplicit-fallthrough)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>/WX</code> and <code>-Werror</code> make your compiler treat warnings as errors, and the other flags enable a lot of useful warnings.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p><strong>Warnings are your friends</strong>. They exist to protect you from bad practices and bugs. Listen to them!</p><p>A C++ code that compiles is far from guaranteed to have no bugs! (mostly because of backward compatibility with C). This is why warnings are important!</p></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>If you are writing a library, using <em>warnings as errors</em> can prevent your users from compiling your library. Since the different compilers (and compiler versions) don&#x27;t generate the same warnings, you might have missed some.</p><p>You should only enable <em>warnings as errors</em> when you are building the tests of your library, and disable it by default for your users. This is what <em>p6</em> does:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">p6/CMakeLists.txt</div><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">set(WARNINGS_AS_ERRORS_FOR_P6 OFF CACHE BOOL &quot;ON iff you want to treat warnings as errors&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (WARNINGS_AS_ERRORS_FOR_P6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(MSVC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target_compile_options(p6 PRIVATE /WX /W4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target_compile_options(p6 PRIVATE -Werror -Wall -Wextra -Wpedantic -pedantic-errors -Wconversion -Wsign-conversion)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_include_directories(p6 PUBLIC include)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_include_directories(p6 SYSTEM PUBLIC include) # When warnings are disabled, we use the SYSTEM option of target_include_directories: this tells the compiler to ignore any warnings coming from the `include` directory.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">p6-tests/CMakeLists.txt</div><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">set(WARNINGS_AS_ERRORS_FOR_P6 ON)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_subdirectory(p6)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ignoring-warnings-from-external-code">Ignoring warnings from external code<a class="hash-link" href="#ignoring-warnings-from-external-code" title="Direct link to heading">â€‹</a></h3><p>Warnings are great, but warnings coming from third-party libraries that you did not write are just a nuisance. Luckily, there is a way to disable them!</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_include_directories(${PROJECT_NAME} SYSTEM PRIVATE some_lib/include)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>SYSTEM</code> option of <a href="https://cmake.org/cmake/help/latest/command/target_include_directories.html" target="_blank" rel="noopener noreferrer"><code>target_include_directories</code></a> tells the compiler to ignore any warnings coming from headers in the <code>some_lib/include</code> directory.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="adding-define-compile-definitions">Adding <code>#define</code> (compile definitions)<a class="hash-link" href="#adding-define-compile-definitions" title="Direct link to heading">â€‹</a></h3><p>You can <code>#define SOMETHING</code> from CMake. This can be useful to propagate information from CMake into your project. For example you can do</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">cmake</div><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_compile_definitions(${PROJECT_NAME} PRIVATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    USE_THIS_FEATURE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-cpp theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">C++</div><div class="codeBlockContent_wNvx cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">USE_THIS_FEATURE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Do something</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">else</span><span class="token macro property" style="color:#36acaa"> </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Do something else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A very good use case is</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_compile_definitions(${PROJECT_NAME} PRIVATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $&lt;$&lt;CONFIG:Debug&gt;:DEBUG&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which defines <code>DEBUG</code> if you are building in debug mode. (This uses a <a href="https://stackoverflow.com/questions/46206495/cmake-generator-expressions" target="_blank" rel="noopener noreferrer">generator expression</a>. It can be read as: &quot;If the CMake <em>CONFIG</em> is <em>Debug</em>, then return <em>DEBUG</em>, otherwise return nothing&quot;). You can then have debug checks in your code that are only compiled in debug mode and totally removed in release:</p><div class="codeBlockContainer_I0IT language-cpp theme-code-block"><div class="codeBlockContent_wNvx cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">assert_shader_is_bound</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GLint id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GLint current_id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">glGetIntegerv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GL_CURRENT_PROGRAM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">current_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current_id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;The shader is not bound&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can also give a value to your <code>#define</code> (by default it gets the value <code>1</code>):</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">cmake</div><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_compile_definitions(${PROJECT_NAME} PRIVATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WINDOW_NAME=\&quot;Django ${CMAKE_PROJECT_VERSION}\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-cpp theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">C++</div><div class="codeBlockContent_wNvx cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">glfwCreateWindow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1280</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">720</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> WINDOW_NAME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Which expands to:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">glfwCreateWindow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1280</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">720</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Django 1.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="setting-the-output-path">Setting the output path<a class="hash-link" href="#setting-the-output-path" title="Direct link to heading">â€‹</a></h3><p>By default your executable will end up in <em>build</em> with many other stuff generated by CMake. You can change that with the target property <code>RUNTIME_OUTPUT_DIRECTORY</code>. I personnaly like to do</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">set_target_properties(${PROJECT_NAME} PROPERTIES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin/${CMAKE_BUILD_TYPE})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which gives me</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ Debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ myproject.exe // Built in debug mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â””â”€â”€ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ Release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚       â”œâ”€â”€ myproject.exe // Built in release mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚       â””â”€â”€ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ build/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ random cmake stuff you don&#x27;t need to care about</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ src/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ CMakeLists.txt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="copying-files-and-folders">Copying files and folders<a class="hash-link" href="#copying-files-and-folders" title="Direct link to heading">â€‹</a></h3><p>Very often in projects you need to have files available alongside your executable; it can be images, 3D models, shaders: anything that is not built into your binary but instead loaded at runtime.</p><p>You will have those files somewhere in your sources, but when you produce an executable and send it to your friends you must not forget to send the other resource files as well! CMake can help you by automating the process of copying these files to the output folder where your executable is created.</p><p><img alt="All the files required by CoolLab.exe" src="/Learn--Clean-Code-With-Cpp/assets/images/cmake-21825b581e75c31942e4ad8b39aa6a94.png" width="582" height="179"></p><p><em>All the files required by CoolLab.exe</em></p><p>There is no straight-forward of asking CMake to do it<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>, but you can <a href="https://github.com/CoolLibs/CMakeUtils" target="_blank" rel="noopener noreferrer">use this great library</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="precompiled-header">Precompiled header<a class="hash-link" href="#precompiled-header" title="Direct link to heading">â€‹</a></h3><p>A precompiled header is pretty useful (see <a href="/Learn--Clean-Code-With-Cpp/lessons/precompiled-header">Precompiled Header</a>).
You can create one with CMake using <a href="https://cmake.org/cmake/help/git-stage/command/target_precompile_headers.html" target="_blank" rel="noopener noreferrer"><code>target_precompile_headers</code></a>:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_precompile_headers(${PROJECT_NAME} PRIVATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;vector&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;memory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;functional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;imgui/imgui.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;imgui/misc/cpp/imgui_stdlib.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;Cool/Log/Log.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="cmake-for-library-authors">CMake for library authors<a class="hash-link" href="#cmake-for-library-authors" title="Direct link to heading">â€‹</a></h2><p>As a library, your <em>CMakeLists.txt</em> has one goal: define a target containing all the required information for people to link to your library.
Users should only have to do</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">add_subdirectory(libname)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(${PROJECT_NAME} PRIVATE libname::libname)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This is possible because a target can store a lot of things: the sources, the include directories, the compile definitions, <em>etc.</em> (this information is known as <em>requirements</em> in the literature). When users call <code>target_link_libraries(${PROJECT_NAME} PRIVATE libname::libname)</code> all this information is propagated to <code>${PROJECT_NAME}</code> by CMake so that our main target will get the proper includes and so on.</p><p><em>If you want to have a look at a real-world example of modern cmake, check out <a href="https://github.com/julesfouchy/p6/blob/main/CMakeLists.txt" target="_blank" rel="noopener noreferrer">p6</a> (small library) or <a href="https://github.com/CoolLibs/Cool/blob/main/CMakeLists.txt" target="_blank" rel="noopener noreferrer">Cool</a> (big framework).</em></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="add_library">add_library()<a class="hash-link" href="#add_library" title="Direct link to heading">â€‹</a></h3><p>You create your library&#x27;s target with</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">add_library(libname)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>(It is the equivalent of <code>add_executable(exename)</code>.)</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="use-the-target_xxx-commands">Use the target_xxx() commands<a class="hash-link" href="#use-the-target_xxx-commands" title="Direct link to heading">â€‹</a></h3><p>To set requirements of your library, always use a <code>target_xxx</code> function. They all have alternatives without the <code>target_</code> prefix, but those functions affect the global state instead of just your target, which is obviously bad! For example if your project uses <em>libA</em> and <em>libB</em>, you don&#x27;t want <em>libB</em> to see the include directories and settings of <em>libA</em>! These libraries should be completely independent!</p><p>They are all used like so:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_xxx(target_name PRIVATE additional_parameters ...)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can also use <code>PUBLIC</code> or <code>INTERFACE</code> instead of <code>PRIVATE</code> (see <a href="#private--public--interface">PRIVATE | PUBLIC | INTERFACE</a>).</p><p>Here are the most important functions:</p><ul><li><a href="https://cmake.org/cmake/help/latest/command/target_include_directories.html" target="_blank" rel="noopener noreferrer"><code>target_include_directories</code></a> Specifies the location of the include files. For a library I would suggest to put them in a <em>include/libname</em> folder and to do <code>target_include_directories(libname PUBLIC include)</code> so that the include files are accessed with <code>#include &lt;libname/some_file.hpp&gt;</code>. It can also be nice to add a <code>libname.hpp</code> file that includes all the other header files. It allows users to include the whole library at once with <code>#include &lt;libname/libname.hpp&gt;</code>.</li><li><a href="https://cmake.org/cmake/help/latest/command/target_sources.html" target="_blank" rel="noopener noreferrer"><code>target_sources</code></a> Adds source files to the target (appends to the list that was already set with <code>add_library(libname some_file.cpp)</code>). It can be useful for example if you only need some files in some situations:</li></ul><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">add_library(Cool src/Cool.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (USE_OPENGL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_sources(Cool PRIVATE src/OpenGL/opengl.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">elseif (USE_VULKAN)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_sources(Cool PRIVATE src/Vulkan/vulkan.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html" target="_blank" rel="noopener noreferrer"><code>target_link_libraries</code></a> To add another target as a dependency.</li><li><a href="https://cmake.org/cmake/help/latest/command/target_compile_options.html" target="_blank" rel="noopener noreferrer"><code>target_compile_options</code></a> We have seen it in <a href="#enabling-warnings">Enabling warnings</a>.</li><li><a href="https://cmake.org/cmake/help/latest/command/target_compile_features.html" target="_blank" rel="noopener noreferrer"><code>target_compile_features</code></a> We have seen it in <a href="#setting-your-c-version">Setting your C++ version</a>.</li><li><a href="https://cmake.org/cmake/help/latest/command/target_compile_definitions.html" target="_blank" rel="noopener noreferrer"><code>target_compile_definitions</code></a> We have seen it in <a href="#adding-define-compile-definitions">Adding <code>#define</code> (compile definitions)</a>.</li><li><a href="https://cmake.org/cmake/help/git-stage/command/target_precompile_headers.html" target="_blank" rel="noopener noreferrer"><code>target_precompile_headers</code></a> We have seen it in <a href="#precompiled-header">Precompiled header</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="private--public--interface">PRIVATE | PUBLIC | INTERFACE<a class="hash-link" href="#private--public--interface" title="Direct link to heading">â€‹</a></h3><p>This is the visibility of the requirements set with <code>target_xxx()</code>.</p><ul><li><p><code>PRIVATE</code>: Only this target will have access to these requirements. When other targets link to this one with <code>target_link_libraries()</code> they will not get the private requirements. For example your warning level should always be private because you do not want to impose it on your dependents:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_compile_options(libname PRIVATE -Werror -Wall)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><code>PUBLIC</code>: This target and all of its dependents will be able to access the public requirements. For example if some include directories are used both internaly and by users to access the library, then they should be public:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_include_directories(libname PUBLIC include)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p> Also if you use some other library in your headers, then it will be visible by your users when they include your header, so you need to provide your users with the library:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(Cool PUBLIC glad)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><code>INTERFACE</code>: This target will <em>not</em> have access to these requirements but its dependents will. It is a bit peculiar but can be used for example in a header-only library: the library itself does not need to see the include directory (since there is no source files at all to build), but the dependents do:</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_include_directories(my-header-only-lib INTERFACE include)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This can also be used if the user-facing headers are different from the private ones (e.g. if you have many headers but only want users to see a <code>libname.hpp</code> header that includes all the other ones):</p><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">target_include_directories(libname INTERFACE include) # The include folder is only used by users and only contains libname.hpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_include_directories(libname PRIVATE src) # All the headers that we use internally are in src (alongside the .cpp)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Try to keep things private as much as possible! Don&#x27;t pollute others for no reason.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="add-an-alias-containing-">Add an alias containing &quot;::&quot;<a class="hash-link" href="#add-an-alias-containing-" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_I0IT language-cmake theme-code-block"><div class="codeBlockContent_wNvx cmake"><pre tabindex="0" class="prism-code language-cmake codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">add_library(p6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_library(p6::p6 ALIAS p6)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>People care about having a name with <code>::</code> because <code>target_link_libraries()</code> can do many different things and if you make a typo in the name of the target it will ignore it instead of reporting an error. It is only if you have a <code>::</code> in the name that <code>target_link_libraries()</code> will know that it can&#x27;t be anything but a target and will raise an error if the name doesn&#x27;t actually correspond to a target.</p><p>As far as the alias name goes, people have different conventions like <code>p6::p6</code>, <code>p6::core</code> <em>etc.</em> Pick one that you like.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="going-further">Going further<a class="hash-link" href="#going-further" title="Direct link to heading">â€‹</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Going Further</h5></div><div class="admonition-content"><p><span><a href="https://youtu.be/mn1ZnO3MtVk" target="_blank">Stephen Kelly<!-- -->, <i>Embracing Modern CMake</i></a><span> (<!-- -->1h<!-- -->)</span></span></p><p><span><a href="https://youtu.be/eC9-iRN2b04" target="_blank">Mathieu Ropert<!-- -->, <i>Using Modern CMake Patterns to Enforce a Good Modular Design</i></a><span> (<!-- -->1h<!-- -->)</span></span></p><p><span><a href="https://cliutils.gitlab.io/modern-cmake/" target="_blank">Henry Schreiner<!-- -->, <i>Modern CMake</i></a><span> (<!-- -->short online book<!-- -->)</span></span></p><p><span><a href="https://youtu.be/YbgH7yat-Jo" target="_blank">Jason Turner<!-- -->, <i>C++ Weekly - Ep 208 - The Ultimate CMake / C++ Quick Start</i></a><span> (<!-- -->30min<!-- -->)</span></span></p></div></div><div class="footnotes"><hr><ol><li id="fn-1">The default functions available in CMake don&#x27;t quite do what we want. They copy the files only once, when the CMakeLists.txt file is run. They won&#x27;t re-copy them automatically whenever they change.<a href="#fnref-1" class="footnote-backref">â†©</a></li></ol></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/Learn--Clean-Code-With-Cpp/tags/c/">C++</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Learn--Clean-Code-With-Cpp/lessons/static-site-generators/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Static site generators</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Learn--Clean-Code-With-Cpp/lessons/precompiled-header/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Precompiled Header</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#brief" class="table-of-contents__link toc-highlight">Brief</a></li><li><a href="#cmake-tips" class="table-of-contents__link toc-highlight">CMake tips</a><ul><li><a href="#setting-your-c-version" class="table-of-contents__link toc-highlight">Setting your C++ version</a></li><li><a href="#glob" class="table-of-contents__link toc-highlight">GLOB</a></li><li><a href="#adding-libraries" class="table-of-contents__link toc-highlight">Adding libraries</a></li><li><a href="#enabling-warnings" class="table-of-contents__link toc-highlight">Enabling warnings</a></li><li><a href="#ignoring-warnings-from-external-code" class="table-of-contents__link toc-highlight">Ignoring warnings from external code</a></li><li><a href="#adding-define-compile-definitions" class="table-of-contents__link toc-highlight">Adding <code>#define</code> (compile definitions)</a></li><li><a href="#setting-the-output-path" class="table-of-contents__link toc-highlight">Setting the output path</a></li><li><a href="#copying-files-and-folders" class="table-of-contents__link toc-highlight">Copying files and folders</a></li><li><a href="#precompiled-header" class="table-of-contents__link toc-highlight">Precompiled header</a></li></ul></li><li><a href="#cmake-for-library-authors" class="table-of-contents__link toc-highlight">CMake for library authors</a><ul><li><a href="#add_library" class="table-of-contents__link toc-highlight">add_library()</a></li><li><a href="#use-the-target_xxx-commands" class="table-of-contents__link toc-highlight">Use the target_xxx() commands</a></li><li><a href="#private--public--interface" class="table-of-contents__link toc-highlight">PRIVATE | PUBLIC | INTERFACE</a></li><li><a href="#add-an-alias-containing-" class="table-of-contents__link toc-highlight">Add an alias containing &quot;::&quot;</a></li></ul></li><li><a href="#going-further" class="table-of-contents__link toc-highlight">Going further</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Other classes</div><ul class="footer__items"><li class="footer__item"><a href="https://julesfouchy.github.io/Learn--Generative-Art" target="_blank" rel="noopener noreferrer" class="footer__link-item">Generative Art</a></li><li class="footer__item"><a href="https://julesfouchy.github.io/Learn--Math-for-Art-and-Computer-Graphics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Math for Art and Computer Graphics</a></li></ul></div><div class="col footer__col"><div class="footer__title">Raise an issue!</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/JulesFouchy/Learn--Clean-Code-With-Cpp/issues/new/choose" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ask a question</a></li><li class="footer__item"><a href="https://github.com/JulesFouchy/Learn--Clean-Code-With-Cpp/issues/new/choose" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report a mistake</a></li><li class="footer__item"><a href="https://github.com/JulesFouchy/Learn--Clean-Code-With-Cpp/issues/new/choose" target="_blank" rel="noopener noreferrer" class="footer__link-item">Give me feedback</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact Me</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/users/372812330742054914" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="mailto:jules.fouchy@ntymail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">E-Mail</a></li><li class="footer__item"><a href="https://github.com/JulesFouchy/JulesFouchy/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">These lessons were written by <a href="https://julesfouchy.github.io/">Jules Fouchy</a> and <a href="https://guillaumehaerinck.com/#/">Guillaume Haerinck</a><br>Copyright Â© 2024. Built with <a href="https://docusaurus.io/">Docusaurus</a>.<div>Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> and <a href="https://www.flaticon.com/authors/justicon" title="justicon">justicon</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div></div></div></div></footer></div>
<script src="/Learn--Clean-Code-With-Cpp/assets/js/runtime~main.9ea0f819.js"></script>
<script src="/Learn--Clean-Code-With-Cpp/assets/js/main.83d7c98f.js"></script>
</body>
</html>